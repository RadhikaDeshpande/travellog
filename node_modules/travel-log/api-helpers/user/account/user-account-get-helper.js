// Connect to the database
var dbConnect = require(DEFS.DIR.DB_CONNECT)('openshift');
var sp        = require(DEFS.DIR.DB_SP);

var userAccount = function() {
  
  // format for call back: callback(returnMsg, returnData);
  // Fetch the user details from DB using the provided user ID
  this.getStatus = function(userId, callback) {

    var returnData = {};
    var returnMsg;

    //Get the USP 
    var getAccountStatus = new sp('usp_get_user_status');
    getAccountStatus.add(userId, false);

    dbConnect.query(getAccountStatus.call(), function(err, rows) {
      console.log(rows);
      if(err || !rows) {
        SCUBE_LOG.info('DB Error : ' + err + 'while fetching User' 
                + 'catergory favorites for user_id' + userId);
        returnMsg = 'failure'
        callback(returnMsg, null);
        return;
      }
      // For Output format refer : 
      // https://sparkking.wikispaces.com/API+-+User+Account
      // Build jsonData for user profile 
      var jsonReqArray = {};
      jsonReqArray.reqtype = DEFS.CONST.JSON_TYPE['singleArraySingleObj'];
      jsonReqArray.reqData = rows;
  
      jBuilder.buildDBDataJSON(jsonReqArray, function(jsonData) {
          // Send back the restructured data
        SCUBE_LOG.info('usp : usp_user_category_preferences success');
        SCUBE_LOG.info(jsonData);
        returnMsg = 'success';
        callback(returnMsg, jsonData);
        return;
      });
    });
  }  
}
module.exports = userAccount;
