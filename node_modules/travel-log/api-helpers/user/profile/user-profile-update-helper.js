//////////////////////////////////////////////////////////////////////////
//                  User Profile Update helpers
// Here we handle all requests related to the USER Profile Update API END POINT 
// Usage: 
//  var userProfileUpdateHelper     = require(DEFS.DIR.API_HELPER_USER_PROFILE_UPDATE);
//  var userProfileUpdateHelperObj  = new userProfileUpdateHelper();
//////////////////////////////////////////////////////////////////////////

// Connect to the database
var dbConnect = require(DEFS.DIR.DB_CONNECT)('openshift');
var sp        = require(DEFS.DIR.DB_SP);

var userProfileUpdateHelper = function() {
  
  this.update = function(userProfileArr, callback) {

    var returnData = {};
    var returnMsg;

    var updateUserProfile = new sp('usp_update_user_profile');

    // Add or Add Null elements are optional, hence need to
    // add the element's value or a NULL depending on its 
    // value. Added addOrAddNull function to lib to reduce 
    // code clutter here
    updateUserProfile.add(userProfileArr.user_id, false);
    updateUserProfile.addOrAddNull(userProfileArr.first_name, true);
    updateUserProfile.addOrAddNull(userProfileArr.last_name, true);
    updateUserProfile.addOrAddNull(userProfileArr.gender, true);
    updateUserProfile.addOrAddNull(userProfileArr.date_of_birth, true);
    updateUserProfile.addOrAddNull(userProfileArr.location, false);
    updateUserProfile.addOrAddNull(userProfileArr.phone_num, true);
    updateUserProfile.addOrAddNull(userProfileArr.image_url, true);
    updateUserProfile.addOrAddNull(userProfileArr.qb_user_id, false);
    
    dbConnect.query(updateUserProfile.call(), function(err, rows) {
      if(err || !rows) {

        SCUBE_LOG.error('DB Error '+err);
        SCUBE_LOG.error('Rows Returned '+rows);
        returnMsg = 'DB Fatal Error while updating user profile';
        callback(returnMsg,returnData);
        return;
      }
  
      returnMsg = "success";
      SCUBE_LOG.info("User profile update successful");
      callback(returnMsg,returnData);
    });
  }
}
module.exports = userProfileUpdateHelper;
