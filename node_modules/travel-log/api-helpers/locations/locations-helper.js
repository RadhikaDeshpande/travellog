
// Connect to the database
var dbConnect = require(DEFS.DIR.DB_CONNECT)('openshift');
var sp        = require(DEFS.DIR.DB_SP);
var locations = function() {

  this.getLocations = function(callback) {
    var locationsSp = new sp('usp_get_locations');

    // Fetch Locations via locations SP
    dbConnect.query(locationsSp.call(), function(err, rows) {
      if (err) {
        console.log("Error in receiving locations list from DB : "+err);
        return false;
      }
      console.log(rows);
      // Location list format : rows[0]
      // [
      //   {
      //   location_id: 1,
      //   location: "Bengaluru"
      //   },
      //   {
      //   location_id: 2,
      //   location: "Hyderabad"
      //   },
      //   {
      //   location_id: 3,
      //   location: "Mumbai"
      //   }
      // ]
      callback(rows[0]);
    });
  },

  this.getLocationId = function(location, callback) {
    var locationIdSp = new sp('usp_get_location_id');
    locationIdSp.add(location, true);

    // Invoke mysql SP for signup request
    dbConnect.query(locationIdSp.call(), function(err, rows) {
      if (err) {
        console.log("Error in receiving Id for "+location+" from DB");
        return false;
      }

      callback(rows[0]);

    });
  }
}

module.exports = locations;
